# Scheduler å¤šåŠŸèƒ½æ—¶åˆ†è°ƒåº¦å™¨

Authorï¼š[Ellu(è‰¾ç‰)](https://github.com/ElluIFX)

## 1. ç®€ä»‹ ğŸ“–

Scheduleræ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„æ—¶åˆ†è°ƒåº¦å™¨ï¼Œå®ƒå¯ä»¥åœ¨è£¸æœºç¯å¢ƒä¸‹å®ç°æŒ‰ä¼˜å…ˆçº§å®šé¢‘ä»»åŠ¡è°ƒåº¦ï¼ˆé«˜ç²¾åº¦å®šæ—¶å™¨ï¼‰ã€å¼‚æ­¥äº‹ä»¶å›è°ƒï¼ˆäº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼‰ã€å¼‚æ­¥åç¨‹ã€å¼‚æ­¥è½¯ä¸­æ–­ã€å»¶æ—¶è°ƒç”¨ç­‰åŠŸèƒ½ã€‚

æœ¬æ–‡æ¡£å°†ä»‹ç»Schedulerçš„APIæ¥å£ã€‚

## 2. å…ˆå†³æ¡ä»¶ ğŸ“‹

æ•´ä¸ªSchedulerçš„å®ç°ä¾èµ–äºé«˜ç²¾åº¦çš„æ—¶é’Ÿï¼Œå› æ­¤éœ€è¦å®ç°æ–‡ä»¶[`scheduler_internal.h`](scheduler_internal.h)ä¸­çš„`get_sys_tick()`å‡½æ•°å’Œ`get_sys_freq()`å‡½æ•°ï¼Œåˆ†åˆ«ç”¨äºè·å–å½“å‰ç³»ç»Ÿæ—¶é’Ÿè®¡æ•°å’Œç³»ç»Ÿæ—¶é’Ÿé¢‘ç‡(Hz)ã€‚

> [!TIP]
> åœ¨ç»å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œæ¨èä½¿ç”¨[`perf_counter`](https://github.com/GorgonMeducer/perf_counter)ç»„ä»¶æ¥å®ç°æ—¶åŸºï¼Œè¿™ä¹Ÿæ˜¯Releaseä¸­çš„é»˜è®¤å®ç°ã€‚

## 3.æ³¨æ„äº‹é¡¹ âš ï¸

åœ¨æœ¬æ¡†æ¶ä¸‹ï¼Œæ‰€æœ‰çš„ä»»åŠ¡ã€äº‹ä»¶ã€åç¨‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å­—ç¬¦ä¸²ï¼ˆ`const char*`ï¼‰ä½œä¸ºæ ‡è¯†ç¬¦ï¼ˆä»»åŠ¡åï¼‰ï¼ŒAPIä¼šæ ¹æ®æä¾›çš„å­—ç¬¦ä¸²æ¥æŸ¥æ‰¾å¯¹åº”çš„å¯¹è±¡ï¼Œå› æ­¤**æ¯ä¸ªå¯¹è±¡çš„æ ‡è¯†ç¬¦å”¯ä¸€ä¸”ä¸å¯æ›´æ”¹**ã€‚

æœ¬æ¡†æ¶é‡‡ç”¨`UList`æ¨¡å—ä½œä¸ºä»»åŠ¡åˆ—è¡¨å­˜å‚¨åŒºï¼Œå› æ­¤éœ€è¦å®ç°åŠ¨æ€å†…å­˜åˆ†é…ã€‚

## 4. é…ç½®å®å®šä¹‰ ğŸ› 

```C
#define SCH_CFG_ENABLE_TASK 1       // æ”¯æŒä»»åŠ¡
#define SCH_CFG_ENABLE_EVENT 1      // æ”¯æŒäº‹ä»¶
#define SCH_CFG_ENABLE_COROUTINE 1  // æ”¯æŒå®åç¨‹
#define SCH_CFG_ENABLE_CALLLATER 1  // æ”¯æŒå»¶æ—¶è°ƒç”¨
#define SCH_CFG_ENABLE_SOFTINT 1    // æ”¯æŒè½¯ä¸­æ–­

#define SCH_CFG_COMP_RANGE_US 1000  // ä»»åŠ¡è°ƒåº¦è‡ªåŠ¨è¡¥å¿èŒƒå›´(us)
#define SCH_CFG_STATIC_NAME 1       // æ˜¯å¦ä½¿ç”¨é™æ€æ ‡è¯†å
#define SCH_CFG_STATIC_NAME_LEN 16  // é™æ€æ ‡è¯†åé•¿åº¦
#define SCH_CFG_PRI_ORDER_ASC 1  // ä¼˜å…ˆçº§å‡åºæ’åº(å‡åº:å€¼å¤§çš„ä¼˜å…ˆçº§é«˜)

#define SCH_CFG_DEBUG_REPORT 1  // è¾“å‡ºè°ƒåº¦å™¨ç»Ÿè®¡ä¿¡æ¯(è°ƒè¯•æ¨¡å¼/ä½æ€§èƒ½)
#define SCH_CFG_DEBUG_PERIOD 5  // è°ƒè¯•æŠ¥å‘Šæ‰“å°å‘¨æœŸ(s)(è¶…è¿‡10sçš„å€¼å¯èƒ½å¯¼è‡´æº¢å‡º)
#define SCH_CFG_DEBUG_MAXLINE 10  // è°ƒè¯•æŠ¥å‘Šæœ€å¤§è¡Œæ•°

#define SCH_CFG_ENABLE_TERMINAL 1  // æ˜¯å¦å¯ç”¨ç»ˆç«¯å‘½ä»¤é›†(ä¾èµ–embedded-cli)
```

+ `SCH_CFG_ENABLE_*`ï¼šæ˜¯å¦ç¼–è¯‘å¯¹åº”å­æ¨¡å—
+ `SCH_CFG_COMP_RANGE_US`ï¼šä»»åŠ¡è°ƒåº¦è‡ªåŠ¨è¡¥å¿èŒƒå›´ï¼Œå½“ä»»åŠ¡è°ƒåº¦çš„å»¶æ—¶å°äºæ­¤å€¼æ—¶ï¼Œè°ƒåº¦å™¨ä¼šè‡ªåŠ¨è¡¥å¿å»¶æ—¶ï¼Œä»¥ä¿è¯è°ƒåº¦é¢‘ç‡ç¬¦åˆè®¾å®šå€¼ï¼Œå¤§äºæ­¤å€¼è¯´æ˜ä»»åŠ¡è€—æ—¶ä¸è®¾å®šé¢‘ç‡ä¸åŒ¹é…ï¼Œå¯ä»¥é€šè¿‡ç»Ÿè®¡ä¿¡æ¯æŸ¥çœ‹ã€‚
+ `SCH_CFG_DEBUG_*`ï¼šè°ƒè¯•ç›¸å…³å®å®šä¹‰ï¼Œå¯ç”¨æ—¶ä¼šæ¯éš”ä¸€æ®µæ—¶é—´åœ¨ä¸²å£ç»ˆç«¯ä¸Šæ‰“å°ä»»åŠ¡ã€äº‹ä»¶ã€åç¨‹ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¿¡æ¯ä¸­æ—¶é—´ç›¸å…³çš„å•ä½å‡ä¸º`us`ï¼Œå ç”¨ç‡å•ä½ä¸º`%`ï¼Œè°ƒè¯•æ¨¡å¼ä¸‹ä¼šé™ä½è°ƒåº¦å™¨æ€§èƒ½ï¼Œä»…ç”¨äºæ’æŸ¥é—®é¢˜ã€‚
+ `SCH_CFG_STATIC_NAME`: æ˜¯å¦ä½¿ç”¨é™æ€æ ‡è¯†åï¼Œå¯ç”¨æ—¶ä¼šä¸ºæ¯ä¸ªå¯¹è±¡åˆ†é…å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ç¼“å†²åŒºï¼Œå…³é—­æ—¶å¯¹è±¡çš„æ ‡è¯†åå°†ç›´æ¥æŒ‡å‘ç”¨æˆ·æä¾›çš„å­—ç¬¦ä¸²æŒ‡é’ˆä»¥æœ€å°åŒ–å ç”¨ï¼Œæ­¤æ—¶ç”¨æˆ·éœ€è¦ä¿è¯å­—ç¬¦ä¸²ä¸ºä¸å˜çš„å…¨å±€å¸¸é‡ã€‚
+ `SCH_CFG_ENABLE_TERMINAL`ï¼šæ˜¯å¦å¯ç”¨ç»ˆç«¯å‘½ä»¤é›†ï¼Œå¯ç”¨æ—¶å¯åœ¨`embedded-cli`ä¸­æ³¨å†Œè°ƒåº¦å™¨ç›¸å…³æ§åˆ¶å‘½ä»¤ï¼Œç”¨äºè°ƒè¯•ã€‚

> [!TIP]
> è°ƒè¯•æ¨¡å¼éå¸¸æœ‰ç”¨ï¼Œå®ƒç±»ä¼¼äºPCçš„ä»»åŠ¡ç®¡ç†å™¨ï¼Œå¯ä»¥é€šè¿‡è°ƒè¯•ä¿¡æ¯æ¥åˆ¤æ–­ä»»åŠ¡å‡½æ•°çš„æ‰§è¡Œæ•ˆç‡ï¼Œäº†è§£ç³»ç»Ÿç“¶é¢ˆå¹¶é’ˆå¯¹æ€§ä¼˜åŒ–ã€‚
---
> [!WARNING]
> åœ¨å¯ç”¨RTOSåï¼Œå¦‚æœçº¿ç¨‹åœ¨æŸä¸ªä»»åŠ¡è¿è¡Œæ—¶è¢«åˆ‡æ¢ï¼Œä¼šå¯¼è‡´è¯¥ä»»åŠ¡çš„ç»Ÿè®¡å ç”¨ä¸Šæ¶¨ï¼Œå¯ä»¥é€šè¿‡ç»™äºˆè°ƒåº¦å™¨æ‰€åœ¨çº¿ç¨‹è¾ƒé«˜çš„ä¼˜å…ˆçº§æ¥é¿å…æ­¤é—®é¢˜ã€‚

## 5. APIæ¥å£ ğŸ“‘

### 5.1. ä¸»æ–‡ä»¶ ([`scheduler.h`](scheduler.h))

> åŒ…å«scheduler.hæ—¶ä¼šè‡ªåŠ¨åŒ…å«æ‰€æœ‰å­æ¨¡å—çš„å¤´æ–‡ä»¶ã€‚

```C
uint64_t scheduler_run(const uint8_t block)
```

+ åŠŸèƒ½ï¼šæ•´ä¸ªè°ƒåº¦å™¨çš„ä¸»å…¥å£ï¼Œæ‰€æœ‰çš„å­æ¨¡å—éƒ½åœ¨æ­¤å¤„å®é™…æ‰§è¡Œç›®æ ‡å‡½æ•°ã€‚
+ è¿”å›ï¼šè·ç¦»ä¸‹ä¸€æ¬¡è°ƒåº¦çš„æ—¶é—´(us)ï¼ŒCPUåº”åœ¨æ­¤æ—¶é—´å‰å†æ¬¡è°ƒç”¨æ­¤å‡½æ•°ä»¥æœ€å°åŒ–è°ƒåº¦å»¶è¿Ÿã€‚
+ å‚æ•°ï¼š
  + `block`ï¼šæ˜¯å¦é˜»å¡ï¼š
    + `0`ï¼šä¸é˜»å¡ï¼Œæ‰§è¡Œå®Œæ‰€æœ‰çš„ä»»åŠ¡åç«‹å³è¿”å›ã€‚
    + `1`ï¼šé˜»å¡ï¼Œå†…éƒ¨å»ºç«‹SuperLoopï¼Œç©ºé—²æ—¶ä¼šè°ƒç”¨`scheduler_idle_handler()`å‡½æ•°ã€‚
+ é™åˆ¶ï¼šéœ€ç¡®ä¿è¯¥å‡½æ•°æ‰€åœ¨çº¿ç¨‹çš„æ ˆç©ºé—´å……è¶³ã€‚

```C
weak void scheduler_idle_handler(uint64_t idleTimeUs)
```

+ åŠŸèƒ½ï¼šç©ºé—²å›è°ƒå‡½æ•°ï¼Œå½“`scheduler_run()`å‡½æ•°çš„`block`å‚æ•°ä¸º`1`æ—¶ï¼Œå½“è°ƒåº¦å™¨ç©ºé—²æ—¶ä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚
+ å‚æ•°ï¼š
  + `idleTimeUs`ï¼šè·ç¦»ä¸‹ä¸€æ¬¡è°ƒåº¦çš„æ—¶é—´(us)ï¼Œå‡½æ•°åº”åœ¨æ­¤æ—¶é—´å†…è¿”å›ã€‚
+ æ³¨æ„ï¼šå¼±å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥åœ¨è‡ªå·±çš„ä»£ç ä¸­é‡å†™æ­¤å‡½æ•°å¹¶å®ç°ä½åŠŸè€—ç­‰é€»è¾‘ã€‚

```C
void sch_add_command_to_cli(EmbeddedCli *cli)
```

+ åŠŸèƒ½ï¼šå°†è°ƒåº¦å™¨ç›¸å…³çš„å‘½ä»¤é›†æ·»åŠ åˆ°`embedded-cli`ä¸­ã€‚
+ å‚æ•°ï¼š
  + `cli`ï¼š`embedded-cli`å¯¹è±¡æŒ‡é’ˆã€‚
+ æ·»åŠ çš„å‘½ä»¤é›†ï¼š
  + `task`ï¼šä»»åŠ¡ç›¸å…³å‘½ä»¤é›†ï¼Œå¯å¯¹ä»»åŠ¡åˆ—è¡¨è¿›è¡Œå¢åˆ æŸ¥æ”¹ã€‚
  + `event`ï¼šäº‹ä»¶ç›¸å…³å‘½ä»¤é›†ï¼Œå¯å¯¹äº‹ä»¶åˆ—è¡¨è¿›è¡Œå¢åˆ å’Œæ‰‹åŠ¨è§¦å‘ã€‚
  + `cortn`ï¼šåç¨‹ç›¸å…³å‘½ä»¤é›†ï¼Œå¯å¯¹åç¨‹åˆ—è¡¨è¿›è¡Œå¢åˆ æŸ¥æ”¹ã€‚
  + `softint`ï¼šè½¯ä¸­æ–­ç›¸å…³å‘½ä»¤é›†ï¼Œå¯å¯¹è½¯ä¸­æ–­è¿›è¡Œæ‰‹åŠ¨è§¦å‘ã€‚
+ æ³¨æ„ï¼šä»…å½“`SCH_CFG_ENABLE_TERMINAL`å®å®šä¹‰ä¸º`1`æ—¶æœ‰æ•ˆã€‚

### 5.2. ä»»åŠ¡ ([`scheduler_task.h`](scheduler_task.h))

ä»»åŠ¡å¯ä»¥è¢«ç†è§£ä¸ºä¸€ä¸ªé«˜ç²¾åº¦çš„è½¯ä»¶å®šæ—¶å™¨ï¼Œå®ƒå¯ä»¥åœ¨è°ƒåº¦å™¨ä¸­ä»¥æŒ‡å®šçš„é¢‘ç‡è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹è°ƒåº¦é¢‘ç‡ã€ä¼˜å…ˆçº§ã€å¯ç”¨çŠ¶æ€ç­‰å‚æ•°ã€‚

```C
uint8_t sch_task_create(const char *name, sch_func_t func, float freq_hz, uint8_t enable, uint8_t priority, void *args)
```

+ åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªä»»åŠ¡ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆå†…å­˜æ“ä½œå‡ºé”™ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šä»»åŠ¡åï¼Œ**ä¸å¯é‡å¤**ã€‚
  + `func`ï¼šä»»åŠ¡å‡½æ•°æŒ‡é’ˆï¼Œè¿”å›ä¸º`void`ï¼Œå‚æ•°ä¸º`void*`ã€‚
  + `freq_hz`ï¼šä»»åŠ¡è°ƒåº¦é¢‘ç‡(Hz)ï¼Œ>0ã€‚
  + `enable`ï¼šåˆ›å»ºåæ˜¯å¦å¯ç”¨ï¼Œ0ï¼šä¸å¯ç”¨ï¼Œ1ï¼šå¯ç”¨ã€‚
  + `priority`ï¼šä»»åŠ¡ä¼˜å…ˆçº§ï¼Œ0ï¼šæœ€ä½ï¼Œ255ï¼šæœ€é«˜ã€‚
  + `args`ï¼šä»»åŠ¡å‚æ•°ï¼Œä¼šä¼ é€’ç»™ä»»åŠ¡å‡½æ•°ã€‚

```C
uint8_t sch_task_delete(const char *name)
```

+ åŠŸèƒ½ï¼šåˆ é™¤ä»»åŠ¡ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°ä»»åŠ¡ï¼‰ã€‚

```C
uint8_t sch_task_get_exist(const char *name)
```

+ åŠŸèƒ½ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å­˜åœ¨ã€‚
+ è¿”å›ï¼š0ï¼šä¸å­˜åœ¨ï¼Œ1ï¼šå­˜åœ¨ã€‚

```C
uint16_t sch_task_get_num(void)
```

+ åŠŸèƒ½ï¼šè·å–ä»»åŠ¡æ•°é‡ã€‚
+ è¿”å›ï¼šä»»åŠ¡æ•°é‡ã€‚

```C
uint8_t sch_task_set_enabled(const char *name, uint8_t enable)
```

+ åŠŸèƒ½ï¼šè®¾ç½®ä»»åŠ¡çš„å¯ç”¨çŠ¶æ€ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°ä»»åŠ¡ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šä»»åŠ¡åã€‚
  + `enable`ï¼š0ï¼šä¸å¯ç”¨ï¼Œ1ï¼šå¯ç”¨ã€‚

```C
uint8_t sch_task_get_enabled(const char *name)
```

+ åŠŸèƒ½ï¼šè·å–ä»»åŠ¡çš„å¯ç”¨çŠ¶æ€ã€‚
+ è¿”å›ï¼š0ï¼šæœªå¯ç”¨æˆ–æœªæ‰¾åˆ°ä»»åŠ¡ï¼Œ1ï¼šå¯ç”¨ã€‚

```C
uint8_t sch_task_set_freq(const char *name, float freq_hz)
```

+ åŠŸèƒ½ï¼šè®¾ç½®ä»»åŠ¡çš„è°ƒåº¦é¢‘ç‡ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°ä»»åŠ¡ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šä»»åŠ¡åã€‚
  + `freq_hz`ï¼šä»»åŠ¡è°ƒåº¦é¢‘ç‡(Hz)ï¼Œ>0ã€‚

```C
uint8_t sch_task_set_priority(const char *name, uint8_t priority)
```

+ åŠŸèƒ½ï¼šè®¾ç½®ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°ä»»åŠ¡ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šä»»åŠ¡åã€‚
  + `priority`ï¼šä»»åŠ¡ä¼˜å…ˆçº§ï¼Œ0ï¼šæœ€ä½ï¼Œ255ï¼šæœ€é«˜ã€‚

```C
uint8_t sch_task_set_args(const char *name, void *args)
```

+ åŠŸèƒ½ï¼šè®¾ç½®ä»»åŠ¡çš„å‚æ•°ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°ä»»åŠ¡ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šä»»åŠ¡åã€‚
  + `args`ï¼šä»»åŠ¡å‚æ•°ï¼Œä¼šä¼ é€’ç»™ä»»åŠ¡å‡½æ•°ã€‚

```C
uint8_t sch_task_delay(const char *name, uint64_t delay_us,
                             uint8_t from_now)
```

+ åŠŸèƒ½ï¼šæ¨è¿Ÿä»»åŠ¡çš„ä¸‹ä¸€æ¬¡è°ƒåº¦ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°ä»»åŠ¡ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šä»»åŠ¡åã€‚
  + `delay_us`ï¼šæ¨è¿Ÿçš„æ—¶é—´(us)ã€‚
  + `from_now`ï¼š1ï¼šä»å½“å‰æ—¶é—´å¼€å§‹è®¡ç®—ï¼Œ0ï¼šä»ä¸Šä¸€æ¬¡è°ƒåº¦æ—¶é—´å¼€å§‹è®¡ç®—ã€‚

### 5.3. äº‹ä»¶ ([`scheduler_event.h`](scheduler_event.h))

äº‹ä»¶æ˜¯ä¸€ç§å¼‚æ­¥å›è°ƒæœºåˆ¶ï¼Œé€šè¿‡æ³¨å†Œä¸€ä¸ªç»Ÿä¸€çš„äº‹ä»¶å›è°ƒå‡½æ•°ï¼Œå¯ä»¥å®ç°è°ƒç”¨æ–¹ä¸åŠŸèƒ½å®ç°çš„è§£è€¦ï¼Œä¸”å¼‚æ­¥æ‰§è¡Œä¿è¯äº†å‡½æ•°ä¸ä¼šåœ¨è°ƒç”¨æ–¹çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œä»è€Œé¿å…äº†è°ƒç”¨æ–¹çš„ä¸Šä¸‹æ–‡è¢«ç ´åã€‚

```C
uint8_t sch_event_create(const char *name, sch_func_t callback,
                               uint8_t enable)
```

+ åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªäº‹ä»¶ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆå†…å­˜æ“ä½œå‡ºé”™ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šäº‹ä»¶åï¼Œ**ä¸å¯é‡å¤**ã€‚
  + `callback`ï¼šäº‹ä»¶å›è°ƒå‡½æ•°æŒ‡é’ˆï¼Œè¿”å›ä¸º`void`ï¼Œå‚æ•°ä¸º`void*`ã€‚
  + `enable`ï¼šåˆ›å»ºåæ˜¯å¦å¯ç”¨ï¼Œ0ï¼šä¸å¯ç”¨ï¼Œ1ï¼šå¯ç”¨ã€‚

```C
uint8_t sch_event_delete(const char *name)
```

+ åŠŸèƒ½ï¼šåˆ é™¤äº‹ä»¶ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°äº‹ä»¶ï¼‰ã€‚

```C
uint8_t sch_event_get_exist(const char *name)
```

+ åŠŸèƒ½ï¼šåˆ¤æ–­äº‹ä»¶æ˜¯å¦å­˜åœ¨ã€‚
+ è¿”å›ï¼š0ï¼šä¸å­˜åœ¨ï¼Œ1ï¼šå­˜åœ¨ã€‚

```C
uint16_t sch_event_get_num(void)
```

+ åŠŸèƒ½ï¼šè·å–äº‹ä»¶æ•°é‡ã€‚
+ è¿”å›ï¼šäº‹ä»¶æ•°é‡ã€‚

```C
uint8_t sch_event_set_enabled(const char *name, uint8_t enable)
```

+ åŠŸèƒ½ï¼šè®¾ç½®äº‹ä»¶çš„å¯ç”¨çŠ¶æ€ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°äº‹ä»¶ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šäº‹ä»¶åã€‚
  + `enable`ï¼š0ï¼šä¸å¯ç”¨ï¼Œ1ï¼šå¯ç”¨ã€‚

```C
uint8_t sch_event_get_enabled(const char *name)
```

+ åŠŸèƒ½ï¼šè·å–äº‹ä»¶çš„å¯ç”¨çŠ¶æ€ã€‚
+ è¿”å›ï¼š0ï¼šæœªå¯ç”¨æˆ–æœªæ‰¾åˆ°äº‹ä»¶ï¼Œ1ï¼šå¯ç”¨ã€‚

```C
uint8_t sch_event_trigger(const char *name, void *args)
```

+ åŠŸèƒ½ï¼šè§¦å‘äº‹ä»¶ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°äº‹ä»¶æˆ–äº‹ä»¶ç¦ç”¨ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šäº‹ä»¶åã€‚
  + `args`ï¼šäº‹ä»¶å‚æ•°ï¼Œä¼šä¼ é€’ç»™äº‹ä»¶å›è°ƒå‡½æ•°ã€‚
+ æ³¨æ„ï¼šäº‹ä»¶æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œå¿…é¡»æ³¨æ„æ‰€ä¼ é€’çš„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¦æ­¢ä¼ é€’ä¸´æ—¶æ•°æ®æŒ‡é’ˆã€‚

```C
uint8_t sch_event_trigger_ex(const char *name, const void *arg_ptr, uint16_t arg_size)
```

+ åŠŸèƒ½ï¼šè§¦å‘äº‹ä»¶å¹¶ä¸ºå‚æ•°åˆ›å»ºä¸´æ—¶æ‹·è´ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°äº‹ä»¶æˆ–äº‹ä»¶ç¦ç”¨ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šäº‹ä»¶åã€‚
  + `arg_ptr`ï¼šäº‹ä»¶å‚æ•°æŒ‡é’ˆï¼Œä¼šè¢«æ‹·è´åˆ°ä¸´æ—¶ç¼“å†²åŒºã€‚
  + `arg_size`ï¼šäº‹ä»¶å‚æ•°å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚
+ å¤‡æ³¨ï¼šæ‹·è´çš„å†…å­˜ä¼šåœ¨å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•åç”±è°ƒåº¦å™¨è‡ªåŠ¨é‡Šæ”¾ã€‚

### 5.4. åç¨‹ ([`scheduler_coroutine.h`](scheduler_coroutine.h))

#### 5.4.1. ä»‹ç»

æœ¬æ¨¡å—åç¨‹ä¾èµ–gotoå’Œå®å®ç°ï¼Œå¹¶ä¸”å…·å¤‡ç®¡ç†å±€éƒ¨å˜é‡ç¼“å†²åŒºçš„èƒ½åŠ›ã€‚

é¦–å…ˆï¼Œä»‹ç»å¦‚ä½•å®šä¹‰ä¸€ä¸ªåç¨‹ï¼š

```C
void coroutine_main(__async__, void *args) // __async__å®å¿…é¡»åœ¨å‡½æ•°å£°æ˜ä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®
{
    CR_INIT_NOLOCAL // å£°æ˜ä¸€ä¸ªæ— å±€éƒ¨å˜é‡åç¨‹, æ­¤å®å¿…é¡»åœ¨å‡½æ•°å†…éƒ¨ç¬¬ä¸€è¡Œ

    // åç¨‹çš„ä»£ç 
    while(1){
        printf("Hello World!\r\n");
        AWAIT_DELAY(1000);
    }
}
```

ä¸Šè¿°ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåç¨‹çš„`ä¸»å‡½æ•°`ï¼Œåç¨‹çš„`ä¸»å‡½æ•°`è¿”å›å€¼å¿…é¡»æ˜¯`void`ç±»å‹ï¼Œå‚æ•°ä¸º`__async__`å’Œ`void*`ï¼Œè¯¥åç¨‹æœªç”¨åˆ°å±€éƒ¨å˜é‡ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨å±€éƒ¨å˜é‡ï¼š

```C
void coroutine_main(__async__, void *args)
{
    CR_INIT_LOCAL_BEGIN  // å£°æ˜ä¸ºæœ‰å±€éƒ¨å˜é‡åç¨‹, æ­¤å®å¿…é¡»åœ¨å‡½æ•°å†…éƒ¨ç¬¬ä¸€è¡Œ
    // åœ¨ä¸­é—´å£°æ˜å±€éƒ¨å˜é‡ï¼ˆä¸å…è®¸èµ‹å€¼ï¼Œä¸€å¾‹åˆå§‹åŒ–ä¸º0ï¼‰
    uint8_t i;
    struct{
        uint8_t a;
        uint8_t b;
    }s;
    CR_INIT_LOCAL_END // å±€éƒ¨å˜é‡å£°æ˜ç»“æŸ

    CR_LOCAL(i) = 23; // å¯ä»¥åœ¨è¿™é‡Œèµ‹åˆå§‹å€¼
    uint8_t temp = 0; // æ­¤å˜é‡ä¸ä¼šè¢«ç»´æŠ¤ï¼Œæ¯æ¬¡å‡½æ•°é‡å…¥æ—¶çš„å€¼æ˜¯æœªå®šä¹‰çš„

    // åç¨‹çš„ä»£ç 
    while(1){
        printf("Hello World! %d\r\n", CR_LOCAL(i)++);
        printf("s: %d %d\r\n", CR_LOCAL(s).a++, CR_LOCAL(s).b++);
        AWAIT_DELAY(1000);
    }
}
```

è¯¥åç¨‹ç”¨åˆ°äº†å±€éƒ¨å˜é‡ï¼Œåˆ™ä½¿ç”¨`CR_INIT_LOCAL_BEGIN()`å’Œ`CR_INIT_LOCAL_END()`å®å°†å±€éƒ¨å˜é‡çš„å®šä¹‰åŒ…è£¹èµ·æ¥ï¼Œ**æ‰€æœ‰çš„å±€éƒ¨å˜é‡å¿…é¡»åœ¨è¿™ä¸¤ä¸ªå®ä¹‹é—´å®šä¹‰ï¼Œä¸”ä½¿ç”¨`CR_LOCAL(var)`å®æ¥è®¿é—®å±€éƒ¨å˜é‡**ï¼Œé™¤æ­¤ä»¥å¤–å®šä¹‰çš„å˜é‡éƒ½æ˜¯`ä¸´æ—¶å˜é‡`ï¼Œä»–ä»¬ä¼šåœ¨ä»»æ„ä¸€æ¬¡`AWAIT_*`å®è°ƒç”¨åè¢«é‡Šæ”¾ï¼Œä¸‹ä¸€æ¬¡å‡½æ•°é‡å…¥æ—¶çš„å€¼æ˜¯**æœªå®šä¹‰çš„**ã€‚

#### 5.4.2. å®API ï¼ˆä¸€èˆ¬åœ¨åç¨‹å‡½æ•°ä¸­è°ƒç”¨ï¼‰

ä¸‹é¢ä»‹ç»æ¯ä¸ªå®çš„ä½œç”¨

1. `CR_INIT_NOLOCAL` **(è°ƒç”¨æ— åˆ†å·)**

    + åŠŸèƒ½ï¼šå£°æ˜ä¸ºæ— å±€éƒ¨å˜é‡åç¨‹ã€‚
    + æ˜¯ `CR_INIT` çš„åˆ«åï¼Œå¯ä»¥äº’ç›¸æ›¿ä»£ã€‚

2. `CR_INIT_LOCAL_START` / `CR_INIT_LOCAL_END` **(è°ƒç”¨æ— åˆ†å·)**

    + åŠŸèƒ½ï¼šå£°æ˜ä¸ºæœ‰å±€éƒ¨å˜é‡åç¨‹ã€‚
    + æ³¨æ„ï¼šäºŒè€…éœ€æˆå¯¹ä½¿ç”¨ã€‚

3. `CR_LOCAL(var)`

    + åŠŸèƒ½ï¼šè®¿é—®è¢«ç»´æŠ¤çš„å±€éƒ¨å˜é‡ã€‚
    + å‚æ•°ï¼š
      + `var`ï¼šå±€éƒ¨å˜é‡åã€‚
    + é™åˆ¶ï¼šä»…ç”¨äºè®¿é—®ç”±`CR_INIT_LOCAL_START()`å’Œ`CR_INIT_LOCAL_END()`åŒ…è£¹çš„å±€éƒ¨å˜é‡ï¼Œå…¶ä»–ä¸´æ—¶å˜é‡æ­£å¸¸è®¿é—®ã€‚

4. `CR_YIELD()`

    + åŠŸèƒ½ï¼šåç¨‹ä¸»åŠ¨è®©å‡ºCPUã€‚

5. `CR_AWAIT(func_cmd, args...)`

    + åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…å¦ä¸€ä¸ª`åç¨‹å­å‡½æ•°`æ‰§è¡Œå®Œæ¯•ã€‚
    + å‚æ•°ï¼š
      + `func_cmd`ï¼šåç¨‹å­å‡½æ•°
      + `args...`ï¼šåç¨‹å­å‡½æ•°çš„å‚æ•°

> [!TIP]
>AWAITå®å¯ä»¥ç±»æ¯”Pythonä¸­çš„`await`å…³é”®å­—ï¼Œç”¨äºç­‰å¾…å¦ä¸€ä¸ª`åç¨‹å­å‡½æ•°`æ‰§è¡Œå®Œæ¯•ï¼Œ`func_cmd`ä¸ºåç¨‹å­å‡½æ•°çš„è°ƒç”¨å‘½ä»¤
---
> [!IMPORTANT]
>`åç¨‹å­å‡½æ•°` ä¸ `åç¨‹ä¸»å‡½æ•°` ä¸åŒï¼Œé™¤äº†__async__å¤–çš„å…¶ä»–å‚æ•°å¯ä»¥ä¸ºä»»æ„ç±»å‹å’Œæ•°é‡ï¼Œä½†ä»ç„¶å¿…é¡»è¿”å›`void`ï¼Œå› æ­¤æ•°æ®çš„ä¼ å…¥ä¼ å‡ºéƒ½éœ€è¦é€šè¿‡å‚æ•°æŒ‡é’ˆæ¥å®ç°ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼š

```C
void receive_array(__async__, uint8_t *buf, uint16_t len)
{
    CR_INIT_LOCAL_START
    uint16_t i;
    CR_INIT_LOCAL_END

    XXXAcquireTransfer();
    while (CR_LOCAL(i) < len) {
      while (!XXXTransferDataReady()) {
          CR_DELAY(1);
      }
      buf[CR_LOCAL(i)++] = XXXGetTransferData();
    }
    XXXReleaseTransfer();
}

void coroutine_main(__async__, void *args) {
  CR_INIT_LOCAL_START
  uint8_t buf[32];
  CR_INIT_LOCAL_END

  while (1) {
    CR_AWAIT(receive_array, CR_LOCAL(buf), 32);
    printf("Recieved: %s\r\n", CR_LOCAL(buf));
  }
}
```

> [!NOTE]
> `åç¨‹å­å‡½æ•°`å¯ä»¥æ— é™åµŒå¥—è°ƒç”¨æ›´å¤šçš„`åç¨‹å­å‡½æ•°`ï¼Œ`åç¨‹ä¸»å‡½æ•°`ä¹Ÿå¯ä»¥æ˜¯ä¸€ç§å•å‚æ•°çš„`åç¨‹å­å‡½æ•°`ã€‚

6. `CR_DELAY(ms)` / `CR_DELAY_US(us)`

    + åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚
    + å‚æ•°ï¼š
      + `ms`ï¼šç­‰å¾…æ—¶é—´(ms)ã€‚
      + `us`ï¼šç­‰å¾…æ—¶é—´(us)ã€‚

> [!TIP]
> AWAIT_DELAYå®å¯ä»¥ç±»æ¯”Pythonä¸­çš„`await asyncio.sleep()`ï¼Œç”¨äºç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚

7. `CR_YIELD_UNTIL(cond)`

    + åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…æ¡ä»¶æ»¡è¶³ã€‚
    + å‚æ•°ï¼š
      + `cond`ï¼šæ¡ä»¶è¡¨è¾¾å¼ï¼Œä¸ºçœŸæ—¶è·³å‡ºé˜»å¡ã€‚

> [!WARNING]
> ç”±äºæ¯æ¬¡è°ƒåº¦å‘¨æœŸéƒ½éœ€è¦é‡å…¥å‡½æ•°ä»¥æ£€æŸ¥æ¡ä»¶ï¼Œè¯¥å®å ç”¨è¾ƒå¤§ï¼Œé™¤éè¦æ±‚æé«˜çš„å®æ—¶æ€§ï¼Œå¦åˆ™åº”ä¼˜å…ˆä½¿ç”¨ä¸‹è¿°çš„`AWAIT_DELAY_UNTIL`å®ã€‚

8. `CR_DELAY_UNTIL(cond, delay_ms)`

    + åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…æ¡ä»¶æ»¡è¶³, æ¯éš”delay_msæ£€æŸ¥ä¸€æ¬¡ã€‚
    + å‚æ•°ï¼š
      + `cond`ï¼šæ¡ä»¶è¡¨è¾¾å¼ï¼Œä¸ºçœŸæ—¶è·³å‡ºé˜»å¡ã€‚
      + `delay_ms`ï¼šæ£€æŸ¥é—´éš”(ms)ã€‚

9. `CR_SELF_NAME()`

    + åŠŸèƒ½ï¼šè·å–å½“å‰`ä¸»åç¨‹`çš„åå­—ã€‚
    + æ³¨æ„ï¼šåœ¨å­åç¨‹ä¸­è°ƒç”¨è¿”å›çš„æ˜¯è°ƒç”¨è¯¥å­åç¨‹çš„æœ€ä¸Šå±‚`ä¸»åç¨‹`çš„åå­—ï¼Œ`å­åç¨‹`å¯¹è±¡ä¸å­˜åœ¨åå­—ã€‚
    + å½©è›‹ï¼šåç¨‹å¤–è°ƒç”¨æ­¤å®ä¼šè¿”å› `__main__`ã€‚

10. `CR_RECV_MSG(to_ptr)`

    + åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…æ¶ˆæ¯ã€‚
    + å‚æ•°ï¼š
      + `to_ptr`ï¼šæ¶ˆæ¯æŒ‡é’ˆï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œæ¶ˆæ¯æŒ‡é’ˆä¼šè¢«èµ‹å€¼ã€‚

11. `CR_SEND_MSG(name, msg)`

    + åŠŸèƒ½ï¼šå‘é€æ¶ˆæ¯ç»™æŒ‡å®šåç¨‹ï¼Œç«‹å³è¿”å›ã€‚
    + å‚æ•°ï¼š
      + `name`ï¼šåç¨‹åã€‚
      + `msg`ï¼šæ¶ˆæ¯æŒ‡é’ˆã€‚
    + ç­‰ä»·ï¼š`sch_cortn_send_msg`

12. `CR_ACQUIRE_MUTEX(mutex_name)`

    + åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…äº’æ–¥é”ã€‚
    + å‚æ•°ï¼š
      + `mutex_name`ï¼šäº’æ–¥é”åã€‚
    + å¤‡æ³¨: è‹¥æŒ‡å®šäº’æ–¥é”ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º

> [!NOTE]
> ç”±äºåç¨‹æ˜¯éæŠ¢å çš„ï¼Œåœ¨å¤§éƒ¨åˆ†ä»£ç å¦‚æ•°æ®è®¿é—®ä¸­ï¼Œå®é™…ä¸Šä¸éœ€è¦ä½¿ç”¨äº’æ–¥é”ã€‚ä½†åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œå¦‚éœ€è¦å¯¹å¤–è®¾è¿›è¡Œè®¿é—®ï¼Œä¸”è®¿é—®ä»£ç ä¸­åŒ…å«CR_DELAY/CR_YIELDï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨äº’æ–¥é”æ¥ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªåç¨‹è®¿é—®å¤–è®¾ã€‚

13. `CR_RUN(name, func, args)`

    + åŠŸèƒ½ï¼šåˆ›å»ºå¹¶å¼‚æ­¥è¿è¡Œä¸€ä¸ªåç¨‹ï¼Œç«‹å³è¿”å›ã€‚
    + å‚æ•°ï¼š
      + `name`ï¼šåç¨‹å, **ä¸å¯é‡å¤**ã€‚
      + `func`ï¼šåç¨‹å‡½æ•°æŒ‡é’ˆï¼Œå¿…é¡»æ˜¯`åç¨‹ä¸»å‡½æ•°`ã€‚
      + `args`ï¼šåç¨‹å‚æ•°æŒ‡é’ˆã€‚
    + ç­‰ä»·ï¼š`sch_cortn_run`

14. `CR_JOIN(name)`

    + åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…ä¸€ä¸ªåç¨‹ç»“æŸã€‚
    + å‚æ•°ï¼š
      + `name`ï¼šåç¨‹åã€‚

#### 5.4.3. å‡½æ•°API ï¼ˆä¸€èˆ¬åœ¨æ­£å¸¸å‡½æ•°ä¸­è°ƒç”¨ï¼‰

```C
uint8_t sch_cortn_run(const char *name, cortn_func_t func, void *args)
```

+ åŠŸèƒ½ï¼šè¿è¡Œä¸€ä¸ªåç¨‹ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆå†…å­˜æ“ä½œå‡ºé”™ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šåç¨‹åï¼Œ**ä¸å¯é‡å¤**ã€‚
  + `func`ï¼šåç¨‹å‡½æ•°æŒ‡é’ˆï¼Œå¿…é¡»æ˜¯`åç¨‹ä¸»å‡½æ•°`ã€‚
  + `args`ï¼šåç¨‹å‚æ•°æŒ‡é’ˆã€‚

```C
uint8_t sch_cortn_stop(const char *name)
```

+ åŠŸèƒ½ï¼šåœæ­¢ä¸€ä¸ªåç¨‹ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°åç¨‹ï¼‰ã€‚
+ é™åˆ¶ï¼šä¸å…è®¸åœ¨ä»»ä½•åç¨‹ä¸­åœæ­¢è‡ªèº«ï¼Œè¿™ç§æƒ…å†µä¸‹è¯·ç›´æ¥returnã€‚

```C
uint8_t sch_cortn_get_running(const char *name)
```

+ åŠŸèƒ½ï¼šæŸ¥è¯¢æŒ‡å®šåç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œ
+ è¿”å›ï¼š0ï¼šæœªè¿è¡Œï¼Œ1ï¼šæ­£åœ¨è¿è¡Œã€‚

```C
uint16_t sch_cortn_get_num(void)
```

+ åŠŸèƒ½ï¼šè·å–åç¨‹æ•°é‡ã€‚
+ è¿”å›ï¼šåç¨‹æ•°é‡ã€‚

```C
uint8_t sch_cortn_get_waiting_msg(const char *name)
```

+ åŠŸèƒ½ï¼šåˆ¤æ–­åç¨‹æ˜¯å¦æ­£åœ¨ç­‰å¾…æ¶ˆæ¯ã€‚
+ è¿”å›ï¼š0ï¼šä¸åœ¨ç­‰å¾…ï¼Œ1ï¼šæ­£åœ¨ç­‰å¾…ã€‚

```C
uint8_t sch_cortn_send_msg(const char *name, void *msg)
```

+ åŠŸèƒ½ï¼šå‘é€æ¶ˆæ¯ç»™æŒ‡å®šåç¨‹å¹¶å”¤é†’ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆæœªæ‰¾åˆ°åç¨‹ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `name`ï¼šåç¨‹åã€‚
  + `msg`ï¼šæ¶ˆæ¯æŒ‡é’ˆã€‚
+ è­¦å‘Š: è¯¥å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦æ³¨æ„æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¦æ­¢ä¼ é€’ä¸´æ—¶æ•°æ®æŒ‡é’ˆã€‚

### 5.5. å»¶æ—¶è°ƒç”¨ ([`scheduler_runlater.h`](scheduler_runlater.h))

å»¶æ—¶è°ƒç”¨å¯ä»¥ç”¨äºå®ç°å»¶æ—¶å…³æœºä¹‹ç±»çš„ä½é¢‘ç‡åŠŸèƒ½ï¼Œä¸è¦é«˜é¢‘ç‡åœ°ä½¿ç”¨ã€‚

```C
uint8_t sch_runlater(Any func, uint64_t delay_us, ...)
```

+ åŠŸèƒ½ï¼šå»¶æ—¶è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚
+ è¿”å›ï¼š1ï¼šæˆåŠŸï¼Œ0ï¼šå¤±è´¥ï¼ˆå†…å­˜æ“ä½œå‡ºé”™ï¼‰ã€‚
+ å‚æ•°ï¼š
  + `func`ï¼šå‡½æ•°æŒ‡é’ˆï¼Œä¸é™åˆ¶è¿”å›å€¼å’Œå‚æ•°ã€‚
  + `delay_us`ï¼šå»¶æ—¶æ—¶é—´(us)ã€‚
  + `args`ï¼šå‡½æ•°å‚æ•°ï¼Œéœ€è¦ä¸å‡½æ•°å£°æ˜åŒ¹é…ã€‚
+ æ³¨æ„1ï¼šæ‰€æœ‰å‚æ•°å¿…é¡»éƒ½æ˜¯å˜é‡(ä¸ºäº†åˆ¤æ–­ç±»å‹), å¸¸é‡å‚æ•°éœ€è¦å…ˆèµ‹å€¼ç»™å˜é‡å†ä¼ é€’ã€‚
+ æ³¨æ„2ï¼šè¯¥å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦æ³¨æ„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¦æ­¢ä¼ é€’ä¸´æ—¶æ•°æ®æŒ‡é’ˆã€‚
+ æ³¨æ„3ï¼šæš‚ä¸æ”¯æŒæµ®ç‚¹æ•°, ä½†å¯ä»¥é€šè¿‡æŒ‡é’ˆä¼ é€’(æ³¨æ„ç”Ÿå‘½å‘¨æœŸ)ã€‚

> [!TIP]
> å°ç¤ºä¾‹

```C
void func(uint8_t a, uint16_t b, uint32_t c, float *d)
{
    printf("a: %d, b: %d, c: %d, d: %f\r\n", a, b, c, *d);
}

void main(void){
    uint8_t a = 1;
    uint16_t b = 2;
    uint32_t c = 3;
    float df = 4.0f;
    float *d = &df;
    sch_runlater(func, 1000000, a, b, c, d);
}
```

```C
void sch_runlater_cancel(Any func)
```

+ åŠŸèƒ½ï¼šå–æ¶ˆå¯¹æŒ‡å®šå‡½æ•°çš„æ‰€æœ‰å»¶æ—¶è°ƒç”¨ã€‚
+ å‚æ•°ï¼š
  + `func`ï¼šå‡½æ•°æŒ‡é’ˆï¼Œä¸é™åˆ¶è¿”å›å€¼å’Œå‚æ•°ã€‚

### 5.6. è½¯ä¸­æ–­ ([`scheduler_softint.h`](scheduler_softint.h))

è½¯ä¸­æ–­å¯ç”¨äºå°†ç¡¬ä»¶ä¸­æ–­ä¸­çš„è°ƒç”¨å»¶è¿Ÿåˆ°è°ƒåº¦å™¨ä¸­æ‰§è¡Œï¼Œä»¥é¿å…ä¸­æ–­åµŒå¥—ã€‚ç›¸æ¯”å…¶ä»–æ–¹æ³•ï¼Œè½¯ä¸­æ–­æ— å†…å­˜æ“ä½œï¼Œå¯ä»¥å®ç°æé«˜é¢‘çš„æ“ä½œï¼Œä½†å­˜åœ¨é€šé“æ•°é‡é™åˆ¶ã€‚

```C
void sch_softint_trigger(uint8_t main_channel, uint8_t sub_channel)
```

+ åŠŸèƒ½ï¼šè§¦å‘è½¯ä¸­æ–­ã€‚
+ å‚æ•°ï¼š
  + `main_channel`ï¼šä¸»é€šé“å·ï¼Œ0~7ã€‚
  + `sub_channel`ï¼šå­é€šé“å·ï¼Œ0~7ã€‚

```C
weak void scheduler_softint_handler(uint8_t main_channel, uint8_t sub_channel_mask)
```

+ åŠŸèƒ½ï¼šè½¯ä¸­æ–­å¤„ç†å‡½æ•°ï¼Œç”±ç”¨æˆ·å®ç°ã€‚
+ å‚æ•°ï¼š
  + `main_channel`ï¼šä¸»é€šé“å·ï¼Œ0~7ã€‚
  + `sub_channel_mask`ï¼šå­é€šé“æ©ç ï¼Œæ¯ä¸€ä½ä»£è¡¨ä¸€ä¸ªå­é€šé“(1 << sub_channel)ï¼Œ1ï¼šè§¦å‘ï¼Œ0ï¼šæœªè§¦å‘ã€‚
+ æ³¨æ„ï¼šå¼±å‡½æ•°ï¼Œç”¨æˆ·æ ¹æ®éœ€è¦è‡ªè¡Œå®šä¹‰æ­¤å‡½æ•°ã€‚
